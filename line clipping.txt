#include <GL/glut.h>
#include <vector>
#include <iostream>
double xmin = 100.0, ymin = 100.0, xmax = 300.0, ymax = 250.0;
const int INSIDE = 0;
const int LEFT   = 1;
const int RIGHT  = 2;
const int BOTTOM = 4;
const int TOP    = 8;
struct Line {
    double x0, y0, x1, y1;
    Line(double a, double b, double c, double d) : x0(a), y0(b), x1(c), y1(d) {}
};
std::vector<Line> lines = {
    Line(50,  50,  350, 300),
    Line(120, 120, 280, 220),
    Line(50,  200, 90,  260),
    Line(200, 50,  200, 300),
    Line(310, 110, 360, 240),
    Line(150, 260, 250, 360),
    Line(250, 150, 400, 150)
};
int computeOutCode(double x, double y) {
    int code = INSIDE;
    if (x < xmin)       code |= LEFT;
    else if (x > xmax)  code |= RIGHT;
    if (y < ymin)       code |= BOTTOM;
    else if (y > ymax)  code |= TOP;
    return code;
}
bool cohenSutherlandClip(double &x0, double &y0, double &x1, double &y1) {
    int outcode0 = computeOutCode(x0, y0);
    int outcode1 = computeOutCode(x1, y1);
    bool accept = false;
    while (true) {
        if ((outcode0 | outcode1) == 0) {
            accept = true;
            break;
        } else if (outcode0 & outcode1) {
            break;
        } else {
            int outcodeOut = outcode0 ? outcode0 : outcode1;
            double x, y;
            double dx = x1 - x0;
            double dy = y1 - y0;
            if (outcodeOut & TOP) {
                x = x0 + dx * (ymax - y0)/dy;
                y = ymax;
            } else if (outcodeOut & BOTTOM) {
                x = x0 + dx * (ymin - y0)/dy;
                y = ymin;
            } else if (outcodeOut & RIGHT) {
                y = y0 + dy * (xmax - x0)/dx;
                x = xmax;
            } else {
                y = y0 + dy * (xmin - x0)/dx;
                x = xmin;
            }
            if (outcodeOut == outcode0) {
                x0 = x;
                y0 = y;
                outcode0 = computeOutCode(x0, y0);
            } else {
                x1 = x;
                y1 = y;
                outcode1 = computeOutCode(x1, y1);
            }
        }
    }
    return accept;
}
void drawText(const char *text, float x, float y) {
    glRasterPos2f(x, y);
    for (const char* c = text; *c != '\0'; ++c)
        glutBitmapCharacter(GLUT_BITMAP_HELVETICA_12, *c);
}
void drawClipRect() {
    glLineWidth(2.0f);
    glColor3f(0.0f, 0.4f, 0.8f);
    glBegin(GL_LINE_LOOP);
        glVertex2d(xmin, ymin);
        glVertex2d(xmax, ymin);
        glVertex2d(xmax, ymax);
        glVertex2d(xmin, ymax);
    glEnd();
    glColor3f(0.0f, 0.0f, 0.0f);
    drawText("Clipping Rect", (xmin + xmax) / 2 - 30, ymax + 10);
}
void display() {
    glClear(GL_COLOR_BUFFER_BIT);
    drawClipRect();
    glLineWidth(1.5f);
    glColor3f(0.8f, 0.2f, 0.2f);
    for (const Line &L : lines) {
        glBegin(GL_LINES);
            glVertex2d(L.x0, L.y0);
            glVertex2d(L.x1, L.y1);
        glEnd();
    }
    glLineWidth(3.0f);
    glColor3f(0.1f, 0.7f, 0.2f);
    for (const Line &L : lines) {
        double cx0 = L.x0, cy0 = L.y0, cx1 = L.x1, cy1 = L.y1;
        bool visible = cohenSutherlandClip(cx0, cy0, cx1, cy1);
        if (visible) {
            glBegin(GL_LINES);
                glVertex2d(cx0, cy0);
                glVertex2d(cx1, cy1);
            glEnd();
        }
    }
    glColor3f(0.0f, 0.0f, 0.0f);
    drawText("Original lines: red", 10, 10);
    drawText("Clipped result: green", 10, 25);

    glutSwapBuffers();
}
void reshape(int w, int h) {
    glViewport(0, 0, w, h);
    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    gluOrtho2D(0.0, (double)w, 0.0, (double)h);
    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();
}
void keyboard(unsigned char key, int x, int y) {
    if (key == 27 || key == 'q' || key == 'Q') {
        exit(0);
    }
}
int main(int argc, char** argv) {
    glutInit(&argc, argv);
    glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);
    int winW = 640, winH = 480;
    glutInitWindowSize(winW, winH);
    glutInitWindowPosition(200, 100);
    glutCreateWindow("Moinuddin Ahmed - 232311076");
    glClearColor(1.0f, 1.0f, 1.0f, 1.0f);
    glutDisplayFunc(display);
    glutReshapeFunc(reshape);
    glutKeyboardFunc(keyboard);
    glutMainLoop();
    return 0;
}